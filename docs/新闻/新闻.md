---
title: 新闻预览
---

<!-- 这里的标题 MkDocs 会自动生成，或者你可以手动写一个 # 标题 -->
<!-- # 每天60秒读懂世界 -->

<div class="daily-news-wrapper">
    <!-- 顶部控制栏 -->
    <div class="news-toolbar">
        <div class="date-picker-box">
            <input type="date" id="news-date-picker" />
        </div>
        <div class="btn-group">
            <button id="news-btn-prev" class="tool-btn" title="前一天">
                <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
            </button>
            <button id="news-btn-next" class="tool-btn" title="后一天">
                <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
            </button>
            <button id="news-btn-today" class="tool-btn text-btn">今天</button>
        </div>
    </div>

    <!-- 图片容器：用于定位加载提示 -->
    <div class="img-container">
        <!-- 加载提示 (绝对定位在图片中间) -->
        <div id="loading-overlay">
            <div class="spinner"></div>
            <div id="loading-text">正在获取日报...</div>
        </div>

        <!-- 图片 -->
        <img id="daily-news-img" src="" alt="今日日报" />
    </div>
</div>

<style>
    /* --- 布局容器 --- */
    .daily-news-wrapper {
        margin-top: 1rem;
        position: relative;
    }

    .img-container {
        position: relative;
        min-height: 300px; /* 给一个最小高度防止页面塌陷 */
        border-radius: 12px;
        overflow: hidden;
        background: var(--md-default-fg-color--lightest); /* 图片未加载时的底色 */
        transition: background 0.3s;
    }

    /* --- 核心：丝滑动画 CSS --- */
    #daily-news-img {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 12px;
        cursor: zoom-in;
        
        /* 初始状态：清晰 */
        opacity: 1;
        filter: blur(0px);
        transform: scale(1);
        
        /* 丝滑过渡配置：贝塞尔曲线让动画更有质感 */
        transition: 
            opacity 0.6s ease, 
            filter 0.6s ease, 
            transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* 弹跳效果 */
    }

    /* 加载状态：模糊、变淡、微缩 */
    #daily-news-img.is-loading {
        opacity: 0.4;         /* 变半透明 */
        filter: blur(15px);   /* 强高斯模糊 */
        transform: scale(0.98); /* 微微缩小 */
    }

    /* --- 加载提示层 (居中悬浮) --- */
    #loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
        pointer-events: none; /* 让鼠标能穿透点击图片 */
        
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    /* 加载层显示时的状态 */
    #loading-overlay.show {
        opacity: 1;
    }

    .spinner {
        width: 30px;
        height: 30px;
        border: 3px solid var(--md-default-fg-color--lighter);
        border-top-color: var(--md-primary-fg-color);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-bottom: 10px;
    }

    #loading-text {
        font-size: 0.9em;
        color: var(--md-default-fg-color--light);
        font-weight: bold;
        text-shadow: 0 1px 2px rgba(255,255,255,0.8);
    }
    [data-md-color-scheme="slate"] #loading-text {
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* --- 顶部工具栏样式 (保持不变) --- */
    .news-toolbar {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        flex-wrap: wrap;
    }
    .date-picker-box {
        background: var(--md-default-fg-color--lightest);
        border-radius: 6px;
        padding: 4px 8px;
        display: flex;
        align-items: center;
        border: 1px solid transparent;
        transition: all 0.2s;
    }
    .date-picker-box:hover { border-color: var(--md-default-fg-color--lighter); }
    #news-date-picker {
        border: none;
        background: transparent;
        font-family: var(--md-code-font-family, monospace);
        font-size: 0.95em;
        color: var(--md-default-fg-color);
        outline: none;
        cursor: pointer;
        font-weight: bold;
    }
    .btn-group { display: flex; gap: 8px; }
    .tool-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 36px;
        min-width: 36px;
        border-radius: 6px;
        border: none;
        background: var(--md-default-fg-color--lightest);
        color: var(--md-default-fg-color);
        cursor: pointer;
        transition: all 0.2s ease;
        padding: 0 8px;
    }
    .tool-btn:hover { background: var(--md-default-fg-color--lighter); transform: translateY(-1px); }
    .tool-btn:active { transform: translateY(0); }
    .text-btn { font-size: 0.9em; font-weight: bold; padding: 0 12px; }
    .tool-btn:disabled, .tool-btn.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; background: rgba(0,0,0,0.05); }

    /* 暗色模式微调 */
    [data-md-color-scheme="slate"] .date-picker-box,
    [data-md-color-scheme="slate"] .tool-btn { background: rgba(255, 255, 255, 0.1); }
    [data-md-color-scheme="slate"] .tool-btn:hover { background: rgba(255, 255, 255, 0.2); }
</style>





<script>
function initDailyNews() {
    // 获取 DOM 元素
    const imgEl = document.getElementById('daily-news-img');
    const loadingOverlay = document.getElementById('loading-overlay');
    const loadingText = document.getElementById('loading-text');
    const prevBtn = document.getElementById('news-btn-prev');
    const nextBtn = document.getElementById('news-btn-next');
    const todayBtn = document.getElementById('news-btn-today');
    const dateInput = document.getElementById('news-date-picker');

    if (!imgEl) return;

    // --- 1. 时间初始化 (强制使用本地时间 00:00:00) ---
    const now = new Date();
    // 这里的 today 是“今天的 0点0分0秒”
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    
    // 当前浏览的日期
    let currentDate = new Date(today);

    // 格式化 YYYY-MM-DD
    function formatDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    // 更新按钮和输入框状态
    function updateState() {
        const isToday = currentDate.getTime() === today.getTime();
        
        // 如果是今天，禁用“下一天”
        if (isToday) {
            nextBtn.disabled = true;
            nextBtn.classList.add('disabled');
        } else {
            nextBtn.disabled = false;
            nextBtn.classList.remove('disabled');
        }
        
        if (dateInput) dateInput.value = formatDate(currentDate);
    }

    // --- 核心加载逻辑 ---
    function loadNews() {
        const dateStr = formatDate(currentDate);
        updateState();

        // [关键修复] 1. 立即重置 UI 状态
        // 无论接下来成功还是失败，先把旧图隐藏/清空
        imgEl.style.display = 'none'; 
        imgEl.src = ''; // 清空 src，防止显示缓存的旧图
        imgEl.classList.remove('is-loading'); // 重置动画类

        // 2. 显示加载层
        if (loadingOverlay) {
            loadingOverlay.classList.add('show');
            loadingText.textContent = `正在获取 ${dateStr} 日报...`;
        }

        // 3. 拼接 URL (加个时间戳防止缓存)
        const src = `https://60s-static.viki.moe/images/${dateStr}.png?t=${new Date().getTime()}`;
        
        const tempImg = new Image();
        tempImg.src = src;

        // 加载成功
        tempImg.onload = function() {
            if (!document.getElementById('daily-news-img')) return;
            
            imgEl.src = src;
            imgEl.style.display = 'block'; // 显示图片元素
            
            // 延迟一小会儿加动画，让它滑出来
            requestAnimationFrame(() => {
                imgEl.classList.add('is-loading'); // 先设为模糊态
                requestAnimationFrame(() => {
                    imgEl.classList.remove('is-loading'); // 移除模糊，触发变清晰动画
                    if (loadingOverlay) loadingOverlay.classList.remove('show');
                });
            });
        };

        // 加载失败 (例如今天还没更新)
        tempImg.onerror = function() {
            // [关键修复] 2. 保持图片隐藏，只显示错误提示
            imgEl.style.display = 'none'; 
            
            if (loadingOverlay) {
                // 保持加载层显示，但改变文字
                loadingText.innerHTML = `
                    <div style="font-size:1.2em;margin-bottom:8px">❌ 暂无日报</div>
                    <div style="font-size:0.85em;opacity:0.7">${dateStr} 的新闻似乎还没发布</div>
                    <div style="font-size:0.85em;opacity:0.7;margin-top:5px">请点击“前一天”查看历史</div>
                `;
            }
        };
        
        imgEl.onclick = function() { window.open(src, '_blank'); };
    }

    // --- 事件绑定 ---

    if (prevBtn) prevBtn.onclick = function() {
        currentDate.setDate(currentDate.getDate() - 1);
        loadNews();
    };

    if (nextBtn) nextBtn.onclick = function() {
        // 计算下一天
        const nextDay = new Date(currentDate);
        nextDay.setDate(nextDay.getDate() + 1);
        
        // 只有当下一天 *真的在未来* 时才阻止
        if (nextDay.getTime() > today.getTime()) return;
        
        currentDate = nextDay;
        loadNews();
    };

    if (todayBtn) todayBtn.onclick = function() {
        currentDate = new Date(today);
        loadNews();
    };

    if (dateInput) {
        dateInput.max = formatDate(today);
        dateInput.onchange = function(e) {
            if (!e.target.value) return;
            const parts = e.target.value.split('-');
            // 使用本地时间构建日期
            const sel = new Date(parts[0], parts[1] - 1, parts[2]);
            
            if (sel.getTime() > today.getTime()) {
                currentDate = new Date(today);
                alert("无法查看未来的新闻哦");
            } else {
                currentDate = sel;
            }
            loadNews();
        };
    }

    // 启动
    loadNews();
}

initDailyNews(); 
</script>